const a6_0x8e6ab=a6_0x1b1b;(function(_0x1ea2ae,_0x9d75f6){const _0x50cac8=a6_0x1b1b,_0xe7f71a=_0x1ea2ae();while(!![]){try{const _0x41cb42=-parseInt(_0x50cac8(0x220))/0x1*(parseInt(_0x50cac8(0x222))/0x2)+parseInt(_0x50cac8(0x203))/0x3*(-parseInt(_0x50cac8(0x1d2))/0x4)+-parseInt(_0x50cac8(0x1cf))/0x5+-parseInt(_0x50cac8(0x219))/0x6*(parseInt(_0x50cac8(0x1ec))/0x7)+parseInt(_0x50cac8(0x1f1))/0x8+-parseInt(_0x50cac8(0x1f0))/0x9*(parseInt(_0x50cac8(0x1ca))/0xa)+parseInt(_0x50cac8(0x1cb))/0xb;if(_0x41cb42===_0x9d75f6)break;else _0xe7f71a['push'](_0xe7f71a['shift']());}catch(_0x134dea){_0xe7f71a['push'](_0xe7f71a['shift']());}}}(a6_0x4c96,0x5ebab));import{downloadMediaMessage}from'baileys-x';import{createWriteStream,existsSync,mkdirSync,renameSync,unlink}from'fs';import{pipeline}from'stream/promises';import{join,extname}from'path';import a6_0x44bd31 from'fs';import a6_0x40a2fc from'pino';import a6_0x896821 from'dotenv';function a6_0x1b1b(_0x199bf6,_0x46ba7c){const _0x4c9604=a6_0x4c96();return a6_0x1b1b=function(_0x1b1b87,_0x51c48d){_0x1b1b87=_0x1b1b87-0x1c5;let _0x3594ba=_0x4c9604[_0x1b1b87];return _0x3594ba;},a6_0x1b1b(_0x199bf6,_0x46ba7c);}import{stat}from'fs/promises';import{convertToOgg}from'./convert_to_ogg.js';const logger=a6_0x40a2fc({'level':process['env'][a6_0x8e6ab(0x1de)]||a6_0x8e6ab(0x1e6),'transport':{'target':a6_0x8e6ab(0x1d3),'options':{'colorize':!![],'ignore':a6_0x8e6ab(0x20b),'translateTime':a6_0x8e6ab(0x1e4),'includeStack':!![],'errorLikeObjectKeys':[a6_0x8e6ab(0x1e7),'error']}},'base':null,'serializers':{'error':a6_0x40a2fc[a6_0x8e6ab(0x1dd)]['err']}}),MIME_EXTENSIONS={'image/jpeg':'jpg','image/jpg':'jpg','image/png':a6_0x8e6ab(0x21d),'image/webp':'webp','image/gif':'gif','video/mp4':'mp4','video/quicktime':a6_0x8e6ab(0x207),'video/3gpp':'3gp','video/x-msvideo':a6_0x8e6ab(0x1df),'audio/mpeg':'mp3','audio/ogg':a6_0x8e6ab(0x1c5),'audio/aac':'aac','audio/mp4':a6_0x8e6ab(0x1f5),'audio/webm':a6_0x8e6ab(0x218),'application/pdf':a6_0x8e6ab(0x217),'application/octet-stream':a6_0x8e6ab(0x215),'text/plain':a6_0x8e6ab(0x1f3)},MEDIA_EXTENSIONS={'audio':a6_0x8e6ab(0x1c5),'video':a6_0x8e6ab(0x1f7),'gif':'mp4','image':'jpg','sticker':a6_0x8e6ab(0x212),'document':a6_0x8e6ab(0x215),'voice':'mp3','unknown':a6_0x8e6ab(0x215)};a6_0x896821['config']();const mediaDir=process[a6_0x8e6ab(0x211)][a6_0x8e6ab(0x21e)]||a6_0x8e6ab(0x1ee),DOWNLOAD_TIMEOUT=parseInt(process['env'][a6_0x8e6ab(0x1fd)])||0xea60;async function downloader_media(_0x415e9f,_0x4e6b11,_0x504f28){const _0xd199aa=a6_0x8e6ab;let _0x90312f=null,_0x9aad6a=null;try{if(!_0x415e9f||!_0x4e6b11)throw new Error(_0xd199aa(0x1ed));if(!isMediaMessage(_0x4e6b11))return logger[_0xd199aa(0x1cd)]('Tentative\x20de\x20téléchargement\x20sur\x20un\x20message\x20non\x20média'),null;!existsSync(mediaDir)&&(mkdirSync(mediaDir,{'recursive':!![]}),logger[_0xd199aa(0x1c8)](_0xd199aa(0x1e3)+mediaDir));logger[_0xd199aa(0x1e6)](_0xd199aa(0x20e)+(_0x4e6b11[_0xd199aa(0x204)]||_0xd199aa(0x1ce)));const {fileExt:_0x57886d,mediaType:_0x311d87}=getNormalizedMediaInfo(_0x4e6b11);if(_0x311d87==='contact'||_0x311d87===_0xd199aa(0x223))return logger[_0xd199aa(0x1cd)]('Type\x20de\x20média\x20non\x20téléchargeable:\x20'+_0x311d87),null;const _0x34cdb3=generateFilename(_0x504f28,_0x311d87,_0x57886d),_0x35a7d5=join(mediaDir,_0x34cdb3);_0x90312f=_0x35a7d5+_0xd199aa(0x210);const _0x15c4c4=new AbortController(),_0x5e749d=setTimeout(()=>{const _0x351010=_0xd199aa;_0x15c4c4[_0x351010(0x205)](),logger[_0x351010(0x1cd)](_0x351010(0x213)+DOWNLOAD_TIMEOUT+'ms');},DOWNLOAD_TIMEOUT);try{_0x9aad6a=await downloadMediaMessage(_0x4e6b11,'stream',{'timeout':DOWNLOAD_TIMEOUT,'signal':_0x15c4c4[_0xd199aa(0x1e1)]},{'reuploadRequest':_0x415e9f['updateMediaMessage'],'logger':logger[_0xd199aa(0x201)]({'module':_0xd199aa(0x206)})});if(!_0x9aad6a)throw new Error(_0xd199aa(0x1ef));return await pipeline(_0x9aad6a,createWriteStream(_0x90312f)),clearTimeout(_0x5e749d),renameSync(_0x90312f,_0x35a7d5),_0x311d87===_0xd199aa(0x1e2)&&_0x57886d!==_0xd199aa(0x1c5)&&(logger[_0xd199aa(0x1e6)](_0xd199aa(0x1f8)),await convertToOgg(_0x35a7d5,_0x35a7d5[_0xd199aa(0x1d8)](extname(_0x35a7d5),_0xd199aa(0x1e5))),logger[_0xd199aa(0x1e6)](_0xd199aa(0x1d6)),a6_0x44bd31['unlinkSync'](_0x35a7d5),logger['info'](_0xd199aa(0x1c7)+_0x35a7d5)),logger[_0xd199aa(0x1e6)](_0xd199aa(0x21f)+_0x34cdb3+'\x20('+_0x311d87+')'),logger['debug'](_0xd199aa(0x1fb)+await getFileSize(_0x35a7d5)+_0xd199aa(0x1e0)),{'chemin':_0x34cdb3,'type':_0x311d87,'fullPath':_0x35a7d5,'size':await getFileSize(_0x35a7d5)};}catch(_0x4c895c){clearTimeout(_0x5e749d);if(_0x15c4c4['signal'][_0xd199aa(0x1ea)])throw new Error(_0xd199aa(0x1da)+DOWNLOAD_TIMEOUT+'ms\x20dépassé');throw _0x4c895c;}}catch(_0x2a9609){logger[_0xd199aa(0x1d0)]({'err':_0x2a9609,'msg':_0xd199aa(0x20d),'messageId':_0x4e6b11?.[_0xd199aa(0x21c)]?.['id'],'mediaType':_0x4e6b11?getMediaType(_0x4e6b11):_0xd199aa(0x1ce)},'Échec\x20du\x20téléchargement:\x20'+_0x2a9609[_0xd199aa(0x1eb)]);if(_0x90312f&&existsSync(_0x90312f))try{await unlink(_0x90312f);}catch(_0x343156){logger['warn'](_0xd199aa(0x1ff)+_0x343156[_0xd199aa(0x1eb)]);}throw new Error(_0xd199aa(0x216)+_0x2a9609[_0xd199aa(0x1eb)]);}finally{if(_0x9aad6a)try{if(typeof _0x9aad6a[_0xd199aa(0x1d9)]==='function')_0x9aad6a['destroy']();else{if(typeof _0x9aad6a[_0xd199aa(0x1c6)]==='function')_0x9aad6a[_0xd199aa(0x1c6)]();else typeof _0x9aad6a['abort']===_0xd199aa(0x1d5)&&_0x9aad6a[_0xd199aa(0x205)]();}}catch(_0x1ca6fa){logger[_0xd199aa(0x1cd)](_0xd199aa(0x20f)+_0x1ca6fa[_0xd199aa(0x1eb)]);}}}function getNormalizedMediaInfo(_0x29c3a5){const _0x28e68a=a6_0x8e6ab,{mediaType:_0x507ec3,mimeType:_0x463c00,fileName:_0x93df34}=getMediaInfo(_0x29c3a5);let _0x30ae9c=MIME_EXTENSIONS[_0x463c00]||MEDIA_EXTENSIONS[_0x507ec3]||_0x28e68a(0x215);return logger[_0x28e68a(0x1c8)](_0x28e68a(0x1db)+_0x507ec3+_0x28e68a(0x20c)+_0x463c00+_0x28e68a(0x1f9)+_0x30ae9c),{'fileExt':_0x30ae9c,'mediaType':_0x507ec3,'mimeType':_0x463c00};}function isMediaMessage(_0x258e1b){const _0x268283=a6_0x8e6ab;if(!_0x258e1b||!_0x258e1b[_0x268283(0x1eb)])return![];const _0x637bf6=_0x258e1b['message'];return Boolean(_0x637bf6[_0x268283(0x209)]||_0x637bf6[_0x268283(0x1f4)]||_0x637bf6['audioMessage']||_0x637bf6[_0x268283(0x21b)]||_0x637bf6[_0x268283(0x21a)]||_0x637bf6[_0x268283(0x1e9)]||_0x637bf6[_0x268283(0x214)]||_0x637bf6[_0x268283(0x202)]?.['contextInfo']?.[_0x268283(0x1d1)]&&isMediaMessage({'message':_0x637bf6[_0x268283(0x202)]['contextInfo']['quotedMessage']}));}function getMediaInfo(_0xd23e8e){const _0x71e848=a6_0x8e6ab;if(!_0xd23e8e||!_0xd23e8e[_0x71e848(0x1eb)])return{'mediaType':'unknown','mimeType':'','fileName':''};const _0x5bb008=_0xd23e8e[_0x71e848(0x1eb)];let _0x53be71=_0x71e848(0x200),_0x394d19='',_0x561d87='';if(_0x5bb008[_0x71e848(0x209)])_0x53be71=_0x71e848(0x1fc),_0x394d19=_0x5bb008[_0x71e848(0x209)]['mimetype'];else{if(_0x5bb008['videoMessage'])_0x53be71=_0x5bb008['videoMessage'][_0x71e848(0x1d7)]?_0x71e848(0x1e8):_0x71e848(0x1fa),_0x394d19=_0x5bb008['videoMessage'][_0x71e848(0x1fe)];else{if(_0x5bb008['audioMessage'])_0x53be71=_0x5bb008[_0x71e848(0x1f2)][_0x71e848(0x1c9)]?_0x71e848(0x1e2):_0x71e848(0x1e2),_0x394d19=_0x5bb008[_0x71e848(0x1f2)]['mimetype'];else{if(_0x5bb008['documentMessage'])_0x53be71=_0x71e848(0x208),_0x394d19=_0x5bb008[_0x71e848(0x21b)]['mimetype'],_0x561d87=_0x5bb008[_0x71e848(0x21b)]['fileName'];else{if(_0x5bb008[_0x71e848(0x21a)])_0x53be71=_0x71e848(0x20a),_0x394d19=_0x5bb008[_0x71e848(0x21a)]['mimetype'];else{if(_0x5bb008[_0x71e848(0x1e9)])_0x53be71=_0x71e848(0x221);else{if(_0x5bb008[_0x71e848(0x214)])_0x53be71=_0x71e848(0x223);else{if(_0x5bb008[_0x71e848(0x202)]?.['contextInfo']?.[_0x71e848(0x1d1)])return getMediaInfo({'message':_0x5bb008[_0x71e848(0x202)][_0x71e848(0x1dc)][_0x71e848(0x1d1)]});}}}}}}}return logger[_0x71e848(0x1c8)](_0x71e848(0x1d4)+_0x53be71+',\x20MIME:\x20'+_0x394d19),{'mediaType':_0x53be71,'mimeType':_0x394d19,'fileName':_0x561d87};}function a6_0x4c96(){const _0x148e10=['env','webp','Timeout\x20du\x20téléchargement\x20après\x20','locationMessage','bin','Échec\x20du\x20téléchargement:\x20','pdf','webm','1861782vzogEa','stickerMessage','documentMessage','key','png','MEDIA_PATH','Média\x20sauvegardé:\x20','1AOpTTZ','contact','267810LtxSFx','location','ogg','close','Ancien\x20fichier\x20supprimé\x20:\x20','debug','ptt','160XuafhY','17415310walIfT','size','warn','inconnu','2886670HGwkPd','error','quotedMessage','8WxhBnL','pino-pretty','Type\x20média\x20détecté:\x20','function','Conversion\x20terminée.','gifPlayback','replace','destroy','Timeout\x20du\x20téléchargement:\x20','Type\x20média:\x20','contextInfo','stdSerializers','LOG_LEVEL','avi','\x20octets','signal','audio','Dossier\x20créé:\x20','HH:MM:ss','.ogg','info','err','gif','contactMessage','aborted','message','7bAvJqY','Paramètres\x20socket\x20ou\x20message_object\x20manquants','./media','Le\x20flux\x20de\x20téléchargement\x20est\x20vide','226521PTRyAk','2188200DYdwAQ','audioMessage','txt','videoMessage','m4a','Impossible\x20de\x20récupérer\x20la\x20taille\x20du\x20fichier:\x20','mp4','Conversion\x20du\x20MP3\x20en\x20OGG...',',\x20Extension:\x20','video','Taille\x20du\x20fichier:\x20','image','DOWNLOAD_TIMEOUT','mimetype','Nettoyage\x20fichier\x20temporaire\x20échoué:\x20','unknown','child','extendedTextMessage','66726hDIkXf','pushName','abort','downloadMediaMessage','mov','document','imageMessage','sticker','pid,hostname',',\x20MIME:\x20','Erreur\x20téléchargement\x20média','Téléchargement\x20média\x20-\x20Expéditeur:\x20','Erreur\x20lors\x20de\x20la\x20fermeture\x20du\x20stream:\x20','.tmp'];a6_0x4c96=function(){return _0x148e10;};return a6_0x4c96();}function generateFilename(_0x40e3ef,_0x1532ad,_0x2f4c17){return _0x40e3ef+'_'+_0x1532ad+'.'+_0x2f4c17;}async function getFileSize(_0x42b290){const _0x32a11d=a6_0x8e6ab;try{const _0x365861=await stat(_0x42b290);return _0x365861[_0x32a11d(0x1cc)];}catch(_0x1be6ed){return logger['warn'](_0x32a11d(0x1f6)+_0x1be6ed[_0x32a11d(0x1eb)]),0x0;}}function getMediaType(_0x633634){const _0x20153a=a6_0x8e6ab;if(!_0x633634||!_0x633634[_0x20153a(0x1eb)])return _0x20153a(0x200);const _0x432ccb=_0x633634['message'];if(_0x432ccb[_0x20153a(0x209)])return _0x20153a(0x1fc);if(_0x432ccb[_0x20153a(0x1f4)])return _0x432ccb[_0x20153a(0x1f4)][_0x20153a(0x1d7)]?_0x20153a(0x1e8):_0x20153a(0x1fa);if(_0x432ccb[_0x20153a(0x1f2)])return _0x432ccb[_0x20153a(0x1f2)][_0x20153a(0x1c9)]?_0x20153a(0x1e2):_0x20153a(0x1e2);if(_0x432ccb[_0x20153a(0x21b)])return'document';if(_0x432ccb[_0x20153a(0x21a)])return _0x20153a(0x20a);if(_0x432ccb['contactMessage'])return _0x20153a(0x221);if(_0x432ccb[_0x20153a(0x214)])return _0x20153a(0x223);return'unknown';}export default downloader_media;